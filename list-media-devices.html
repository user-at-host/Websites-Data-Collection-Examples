<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Hardware Information</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">

    <style>
        .info-box {
            display: flex;
            justify-content: space-between;
            align-items: center;

            background-color: var(--pico-card-background-color);
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            box-shadow: var(--pico-card-box-shadow);
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
        }

        .info-label {
            font-weight: bold;
            color: var(--pico-primary);
        }

        .info-value {
            font-family: var(--pico-font-family-monospace);
            background-color: var(--pico-muted-background-color);
            padding: 0.25rem 0.5rem;
            border-radius: var(--pico-border-radius);
        }
    </style>

</head>

    <body>

        <main class="container">
            <article>
                <h1>Media Device Lister</h1>
                
                <div class="note">
                    <p><strong>Note:</strong> To protect your privacy, browsers won't show device names (labels) until you grant permission. Clicking the button below will trigger a permission prompt for your camera and microphone.</p>
                </div>

                <br>
                <button id="listDevicesBtn">List My Devices</button>

                <h2>Detected Devices:</h2>
                <pre id="deviceList">Click the button to start...</pre>

                <script>
                    const listDevicesBtn = document.getElementById('listDevicesBtn');
                    const deviceList = document.getElementById('deviceList');

                    listDevicesBtn.addEventListener('click', async () => {
                        deviceList.textContent = 'Requesting permissions and searching for devices...';

                        if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
                            deviceList.textContent = 'The mediaDevices API (enumerateDevices) is not supported by your browser.';
                            return;
                        }

                        // Use a 'finally' block to ensure hardware is released.
                        let stream = null;
                        try {
                            // This call is necessary to trigger the permission prompt and unlock device labels.
                            stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true });
                            const devices = await navigator.mediaDevices.enumerateDevices();
                            
                            if (devices.length === 0) {
                                deviceList.textContent = 'No media devices found.';
                                return;
                            }

                            let output = '';
                            let audioInputs = 0, audioOutputs = 0, videoInputs = 0;

                            devices.forEach(device => {
                                let type = '';
                                if (device.kind === 'audioinput') {
                                    type = `Microphone ${++audioInputs}`;
                                } else if (device.kind === 'audiooutput') {
                                    type = `Speaker ${++audioOutputs}`;
                                } else if (device.kind === 'videoinput') {
                                    type = `Camera ${++videoInputs}`;
                                }
                                
                                output += `--------------------------------\n`;
                                output += `${type}:\n`;
                                output += `  Label: ${device.label || 'Name not available (permission denied?)'}\n`;
                                output += `  Kind: ${device.kind}\n`;
                                output += `  Device ID: ${device.deviceId}\n`;
                            });

                            deviceList.textContent = output;

                        } catch (err) {
                            let errorMessage = `Error: ${err.name}`;
                            if (err.name === "NotAllowedError") {
                                errorMessage += "\n\nYou denied permission to access media devices. Device labels cannot be read.";
                            } else {
                                errorMessage += `\n\n${err.message}`;
                            }
                            deviceList.textContent = errorMessage;
                        } finally {
                            // Stop all tracks to turn off the camera/mic light immediately.
                            if (stream) {
                                stream.getTracks().forEach(track => track.stop());
                            }
                        }
                    });
                </script>
            </article>
        </main>

    </body>
</html>
